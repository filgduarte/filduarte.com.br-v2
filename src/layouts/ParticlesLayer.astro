---
    const {depth, speed} = Astro.props;
---

<div class={`particles layer layer--${depth}`} data-speed={speed}>
    <slot />
</div>

<style is:global>
    .particles {
        --_particles-base-size: 100px;
        --_color-particles: var(--_theme-color-accent);

        transform: translateY(var(--_y, 0));
    }

    .layer {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
    }

    .layer--far {
        opacity: 0.5;
        z-index: 0;
    }

    .layer--close {
        z-index: 2;
    }

    .layer--closest {
        z-index: 3;
    }

    .layer div {
        --_animation-duration: 10s;

        position: absolute;
        top: var(--_top, auto);
        right: var(--_right, auto);
        bottom: var(--_bottom, auto);
        left: var(--_left, auto);
        background-color: rgb( var(--_theme-color-accent-rgb) / 0.75 );
        background-image:
            url('/img/noise-light.png'),
            linear-gradient(135deg, rgb( var(--_theme-color-background-rgb) / 0.75 ), transparent);
        transform-origin: 0 0;
        scale: var(--_scale, 1);
        animation: float var(--_animation-duration) ease-in-out infinite;
        animation-delay: var(--_delay, 0);
    }

    .layer--far * {
        --_scale: 0.2;
    }

    .layer--closest * {
        --_scale: 2;
    }

    /* .layer--close *,
    .layer--closest * {
        backdrop-filter: blur(2px);
    } */
</style>

<script>
    import { gsap } from 'gsap';
    import { ScrollTrigger } from 'gsap/ScrollTrigger';

    gsap.registerPlugin(ScrollTrigger);

    gsap.to('.layer', {
        scrollTrigger: {
            scrub: true
        },
        y: (i, target) => -ScrollTrigger.maxScroll(window) * target.dataset.speed,
        ease: 'none'
    });
</script>